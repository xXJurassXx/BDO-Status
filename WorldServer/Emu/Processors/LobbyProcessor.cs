using System;
using System.Collections.Generic;
using System.Linq;
using Commons.Enums;
using Commons.Models.Character;
using Commons.UID;
using Commons.Utils;
using FluentNHibernate.Cfg;
using FluentNHibernate.Cfg.Db;
using NHibernate;
using NHibernate.Tool.hbm2ddl;
using NHibernate.Util;
using NLog;
using WorldServer.Configs;
using WorldServer.Emu.Extensions;
using WorldServer.Emu.Interfaces;
using WorldServer.Emu.Models.Creature.Player;
using WorldServer.Emu.Models.MySql.Mapping.WorldMap;
using WorldServer.Emu.Models.Storages;
using WorldServer.Emu.Models.Storages.Abstracts;
using WorldServer.Emu.Networking;
using WorldServer.Emu.Networking.Handling.Frames.Send;
using WorldServer.Emu.Networking.Handling.Frames.Send.OPSBlob;
/*
Author:Sagara
*/
namespace WorldServer.Emu.Processors
{
    public class LobbyProcessor : IProcessor
    {
        /// <summary>
        /// Logger for this class
        /// </summary>
        private static readonly Logger Log = LogManager.GetCurrentClassLogger();

        /// <summary>
        /// Game server dao factory
        /// </summary>
        private static ISessionFactory _gsDbFactory;

        private static object _gsObj;

        /// <summary>
        /// Character uids generator
        /// </summary>
        private static Int32UidFactory _characterUidsFactory;

        /// <summary>
        /// Items uids generator
        /// </summary>
        private static Int32UidFactory _itemsUidsFactory;

        /// <summary>
        /// Game session uid`s generator
        /// </summary>
        private static Int32UidFactory _gameSessionFactory;

        /// <summary>
        /// Initilize service action
        /// </summary>
        /// <param name="previousInstanceContext"></param>
        public void OnLoad(object previousInstanceContext)
        {
            var config = Fluently.Configure().Database(MySQLConfiguration.Standard.ConnectionString(cs => cs.Is(
                    $"Server={CfgDatabase.Default.GameServerDaoHost};" +
                    $"Database={CfgDatabase.Default.GameServerDaoDatabase};" +
                    $"User={CfgDatabase.Default.GameServerDaoUsername}" +
                    $";Password={CfgDatabase.Default.GameServerDaoPassword};" +
                    "CharSet=utf8"))).Mappings(m =>
                    {
                        m.FluentMappings.AddFromNamespaceOf<CharacterMap>().AddFromNamespaceOf<StorageMap>();
                    });
            
            var export = new SchemaUpdate(config.BuildConfiguration());

            export.Execute(false, true);

            _gsDbFactory = config.BuildSessionFactory();

            var usedIds =  //Get all used character id`s
                _gsDbFactory.OpenSession().CreateSQLQuery("select `c_character_id` from `bd_characters`").List();

            var usedItemUids = _gsDbFactory.OpenSession().CreateSQLQuery("select `i_item_uid` from `bd_items`").List();

            if (usedIds.Any())
            {
                var cId = int.Parse(usedIds[usedIds.Count - 1].ToString());

                _characterUidsFactory = new Int32UidFactory(cId);
            }
            else _characterUidsFactory = new Int32UidFactory();
            
            if (usedItemUids.Any())
            {
                var iUid = int.Parse(usedItemUids[usedItemUids.Count - 1].ToString());

                _itemsUidsFactory = new Int32UidFactory(iUid);
            }
            else _itemsUidsFactory = new Int32UidFactory();

            _gameSessionFactory = new Int32UidFactory();
            _gsObj = new object();
        }

        public void GetCharacterList(ClientConnection connection)
        {
            using (var db = _gsDbFactory.OpenSession())
            {
                var list = db.QueryOver<CharacterData>().Where(p => p.AccountId == connection.Account.Id).List();
                
                if(list != null)
                    connection.Characters = (List<CharacterData>) list;
                else
                    connection.Characters = new List<CharacterData>();

                foreach (var characterData in connection.Characters)               
                    characterData.EquipmentData = new EquipmentStorage(db.QueryOver<CharacterItem>().Where(i => 
                    i.CharacterId == characterData.CharacterId && i.StorageType == (int)StorageType.Equipment).List().ToDictionary<CharacterItem, short, AStorageItem>(e => 
                    (short)(e.Slot + 1), e => new InventoryItem(e.ItemId, e.Count) {StorageType = (StorageType) e.StorageType}), 48);

				// SMSG_LoginUserToFieldServer
				//new SpRaw("00000000AC110000019CB300F2A2AC2064450300000000004300680061006F007300470061006D0065007300000000000000000000000000000000000000000000000000000000000000000000000000000000000000FFFF00000100FFFFFFFFFFFFFFFF00000000000000000103008CEB454FD7946A000052006500640042006C006F006F0064006500640057006F006D0061006E0000000000000000000000000000000000000000000000000000000000000000000600000004000000A1280000FFFFFFFFFFFFFFFF3200FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF0005290000FFFFFFFFFFFFFFFF3200FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF0000000000FEFFFFFFFFFFFFFF0000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF0000000000FEFFFFFFFFFFFFFF0000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF0000000000FEFFFFFFFFFFFFFF0000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF0000000000FEFFFFFFFFFFFFFF0000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF0000000000FEFFFFFFFFFFFFFF0000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF0000000000FEFFFFFFFFFFFFFF0000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF0000000000FEFFFFFFFFFFFFFF0000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF0000000000FEFFFFFFFFFFFFFF0000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF0000000000FEFFFFFFFFFFFFFF0000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF0000000000FEFFFFFFFFFFFFFF0000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF0000000000FEFFFFFFFFFFFFFF0000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF0000000000FEFFFFFFFFFFFFFF0000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF0000000000FEFFFFFFFFFFFFFF0000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF0000000000FEFFFFFFFFFFFFFF0000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF0000000000FEFFFFFFFFFFFFFF0000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF0000000000FEFFFFFFFFFFFFFF0000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF0000000000FEFFFFFFFFFFFFFF0000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF0000000000FEFFFFFFFFFFFFFF0000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF0000000000FEFFFFFFFFFFFFFF0000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF0000000000FEFFFFFFFFFFFFFF0000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF0000000000FEFFFFFFFFFFFFFF0000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF0000000000FEFFFFFFFFFFFFFF0000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF0000000000FEFFFFFFFFFFFFFF0000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF0000000000FEFFFFFFFFFFFFFF0000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF0000000000FEFFFFFFFFFFFFFF0000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF0000000000FEFFFFFFFFFFFFFF0000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF0000000000FEFFFFFFFFFFFFFF0000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF0000000000FEFFFFFFFFFFFFFF0000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF0000000000FEFFFFFFFFFFFFFF0000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00000600000000010000000700000000000000000004000800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003000000000000000000000000000000000000000000000000000000000200000000000000000200000000000000FE000000000000000002000000000000000100FC0000000000000100FC0000000000000002FF00000000000000FEFF0000000000000000FF000000000000002E00020100020100020000020000000000000000F800FC0000000000FC00FCFC000000000000000000050505050505000000000000FCFDFDFCFDFDFEFDFDFEFDFDFCFCFCFCFCFC0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000646464320064150032326464000408010032323200004432323201010032323200060017623D114047321422641701000000010001014E00003F00001B3A3E3A0000372C443200004133642400001B3A3E3A0000372C4432000041336424000000643232326464640001000000000000000000000000000000000000000000000064000000080000000000000060A0DEED1700000090A1000000000000B0F6A485FE7F000090A1000000000000703EC7E417000000001000000000000054EC9EF717000000B8EC9EFFFFFFFFFFFFFFFF0077A1E956000000008AFBE65600000000009EF8C700E08AC480C6D647FFFFFFFFFFFFFFFF0000C5F2EA560000000000000000000000000000000000000000000000000000A009DEED17000000C058", 0x0C99).SendRaw(connection);
				// SMSG_FixedCharge
				//new SpRaw("FEFFFFFFFFFFFFFF00", 0x0C78).SendRaw(connection);

				new SMSG_LoginUserToFieldServer(connection.Account, connection.Characters).Send(connection);
                new SMSG_FixedCharge();
            }
        }

        public void CreateCharacterProcess(ClientConnection connection, CharacterData info)
        {
            var characterData = info;

            using (var db = _gsDbFactory.OpenSession())
            {
                if (db.QueryOver<CharacterData>().Where(s => s.CharacterName == info.CharacterName).Take(1).SingleOrDefault() != null)
                {
                    new SMSG_CreateCharacterToFieldNak().Send(connection);

                    return;
                }
                   
                using (var transaction = db.BeginTransaction())
                {
                    try
                    {
                        characterData.CharacterId = _characterUidsFactory.Next();
                        characterData.Surname = connection.Account.FamilyName;
                        characterData.Level = 1;
                        characterData.CreationDate = DateTime.Now;
                        characterData.CreatedId = 0; // for nhibernate driver

						/* TEMP FIX UNTIL DATA IS FOUND AND LOADED */
						switch (characterData.ClassType)
						{
							case ClassType.Warrior:
                                characterData.PositionX = -153728;
								characterData.PositionY = 531;
								characterData.PositionZ = 130574;
								break;
							case ClassType.Ranger:
                                characterData.PositionX = -138793;
								characterData.PositionY = -1208;
								characterData.PositionZ = 137342;
								break;
							case ClassType.Sorcerer:
                                characterData.PositionX = -135621;
								characterData.PositionY = 802;
								characterData.PositionZ = 107359;
								break;
							case ClassType.Giant:
                                characterData.PositionX = -120118;
								characterData.PositionY = -1625;
								characterData.PositionZ = 118794;
								break;
							case ClassType.Tamer:
                                characterData.PositionX = -159853;
								characterData.PositionY = 2089;
								characterData.PositionZ = 123726;
								break;
							case ClassType.BladeMaster:
                                characterData.PositionX = -154408;
								characterData.PositionY = -335;
								characterData.PositionZ = 135204;
								break;
							case ClassType.BladeMasterWomen:
								characterData.PositionX = -154408;
								characterData.PositionY = -335;
								characterData.PositionZ = 135204;
								break;
							case ClassType.Valkyrie:
                                characterData.PositionX = -145479;
								characterData.PositionY = 2185;
								characterData.PositionZ = 110947;
								break;
							case ClassType.Kunoichi:
                                characterData.PositionX = -136152;
								characterData.PositionY = -730;
								characterData.PositionZ = 128869;
								break;
							case ClassType.Ninja:
								characterData.PositionX = -136152;
								characterData.PositionY = -730;
								characterData.PositionZ = 128869;
								break;
							case ClassType.Wizard:
                                characterData.PositionX = -157013;
								characterData.PositionY = 946;
								characterData.PositionZ = 128052;
								break;
							case ClassType.WizardWomen:
								characterData.PositionX = -157013;
								characterData.PositionY = 946;
								characterData.PositionZ = 128052;
								break;
						}

                        var inventory = InventoryStorage.GetDefault(characterData.ClassType);
                        foreach (var daoItem in inventory.Items.Select(item => new CharacterItem
                        {
                            CharacterId = characterData.CharacterId,
                            ItemId = item.Value.ItemId,
                            ItemUid = _itemsUidsFactory.Next(),
                            Slot = item.Key - 1,
                            Count = item.Value.Count,
                            StorageType = (int) ((InventoryItem)item.Value).StorageType
                        }))                       
                            db.Save(daoItem);
                        
                        db.Save(characterData);

                        connection.Characters.Add(characterData);

                        new SMSG_CreateCharacterToField(characterData).Send(connection, false);

                        transaction.Commit();
                    }
                    catch (Exception ex)
                    {
                        transaction.Rollback();
                        Log.Error($"Cannot create character\n{ex}");
                    }                   
                }
            }          
        }

        public void DeleteCharacterProcess(ClientConnection connection, long characterId)
        {
            using (var db = _gsDbFactory.OpenSession())
            {
                using (var transaction = db.BeginTransaction())
                {
                    try
                    {
                        var deletionTime = (int)(DateTime.Now.UnixMilliseconds() / 1000);
                        var deleted = connection.Characters.First(s => s.CharacterId == characterId);

                        var equipment = db.QueryOver<CharacterItem>().Where(i => i.CharacterId == deleted.CharacterId).List();
                        for (int i = 0; i < equipment.Count; i++)
                            db.Delete(equipment[i]);
                        
                        db.Delete(deleted);

						// TODO: Delayed removed task
						bool isDelayedDelete = false;
                        new SMSG_RemoveCharacterFromField(characterId, isDelayedDelete, deletionTime).Send(connection);

                        transaction.Commit();
                    }
                    catch(Exception ex)
                    {
                        transaction.Rollback();
                        Log.Error(ex);
                    }
                }
            }
        }

        public void UpdateCharacter(ClientConnection connection)
        {
            using (var db = _gsDbFactory.OpenSession())
            {
                using (var transaction = db.BeginTransaction())
                {
                    try
                    {
                        var equipment = db.QueryOver<CharacterItem>().Where(i => i.CharacterId == connection.ActivePlayer.DatabaseCharacterData.CharacterId).List();
                        for (int i = 0; i < equipment.Count; i++)
                            db.Delete(equipment[i]);

                        /*Update inventory items*/
                        foreach (var daoItem in connection.ActivePlayer.Inventory.Items.Select(item => new CharacterItem
                        {
                            CharacterId = connection.ActivePlayer.DatabaseCharacterData.CharacterId,
                            ItemId = item.Value.ItemId,
                            ItemUid = _itemsUidsFactory.Next(),
                            Slot = item.Key - 1,
                            Count = item.Value.Count,
                            StorageType = (int)((InventoryItem)item.Value).StorageType
                        })) db.Save(daoItem);

                        /*Update equipment items*/
                        foreach (var daoItem in connection.ActivePlayer.Equipment.Items.Select(item => new CharacterItem
                        {
                            CharacterId = connection.ActivePlayer.DatabaseCharacterData.CharacterId,
                            ItemId = item.Value.ItemId,
                            ItemUid = _itemsUidsFactory.Next(),
                            Slot = item.Key - 1,
                            Count = item.Value.Count,
                            StorageType = (int)((InventoryItem)item.Value).StorageType
                        }))db.Save(daoItem);

                        db.Update(connection.ActivePlayer.DatabaseCharacterData);

                        transaction.Commit();
                    }
                    catch (Exception ex)
                    {
                        Log.Error($"Cannot update player id:{connection.ActivePlayer.DatabaseCharacterData.CharacterId} exception:\n{ex}");

                        transaction.Rollback();
                    }
                }
            }
        }

		public void InitialEnterWorld(ClientConnection connection, long characterId)
		{
			
			var player = new Player(connection, connection.Characters.First(s => s.CharacterId == characterId))
			{
				GameSessionId = _gameSessionFactory.Next(),
			};

			using (var db = _gsDbFactory.OpenSession())
			{
				var daoItems = db.QueryOver<CharacterItem>().Where(i => i.CharacterId == characterId).List();
				var items = new List<CharacterItem>();
				var equipItems = new List<CharacterItem>();

				foreach (var it in daoItems)
				{
					if (it.StorageType == (int)StorageType.Equipment)
						equipItems.Add(it);
					if (it.StorageType == (int)StorageType.Inventory)
						items.Add(it);
				}

				player.Inventory = new InventoryStorage(items.ToDictionary<CharacterItem, short, AStorageItem>(e => (short)(e.Slot + 1), e => new InventoryItem(e.ItemId, e.Count) { StorageType = (StorageType)e.StorageType }), 48);
				player.Equipment = new EquipmentStorage(equipItems.ToDictionary<CharacterItem, short, AStorageItem>(e => (short)(e.Slot + 1), e => new InventoryItem(e.ItemId, e.Count) { StorageType = (StorageType)e.StorageType }), 48);
			}

			connection.ActivePlayer = player;
			connection.ActivePlayer.PlayerActions += (action, parameters) =>
			{
				switch (action)
				{
					case Player.PlayerAction.Logout:
						if (connection.ActivePlayer != null)
						{
							UpdateCharacter(connection);
							_gameSessionFactory.ReleaseUniqueInt(connection.ActivePlayer.GameSessionId);
						}
						break;
				}
			};

			var sessionId = BitConverter.GetBytes(connection.ActivePlayer.GameSessionId).ToHex();
			var uid = BitConverter.GetBytes(connection.ActivePlayer.Uid).ToHex();
			
			new SMSG_CancelFieldEnterWaiting().Send(connection);
			new SMSG_SetGameTime().Send(connection);
			new SMSG_EnterPlayerCharacterToField(connection.ActivePlayer).Send(connection);
			new SMSG_LoadField().Send(connection);
			new SMSG_AddPlayers(connection.ActivePlayer, 1).Send(connection);
			new SMSG_PlayerLogOnOff(connection.ActivePlayer).Send(connection);
			new SMSG_LoadFieldComplete().Send(connection);
			new SMSG_EnterPlayerCharacterToFieldComplete().Send(connection);
			new SMSG_RefreshPcCustomizationCache(connection.ActivePlayer).Send(connection);
			new SMSG_RefreshPcLearnedActiveSkillsCache(connection.ActivePlayer).Send(connection);
			new SBpPlayerSpawn.SMSG_RefreshPcEquipSlotCache(connection.ActivePlayer).Send(connection);
			new SBpPlayerSpawn.SMSG_RefreshUserBasicCache(connection.ActivePlayer).Send(connection);
			new SBpPlayerSpawn.SMSG_RefreshPcBasicCache(connection.ActivePlayer).Send(connection);

			/*
			// SMSG_CancelFieldEnterWaiting
			new SpRaw("000000000000000000000000", 0x0CF4).SendRaw(connection);
			// SMSG_SetGameTime
			new SpRaw("77E6EA560000000000000000B3E3E1060000000000A0AE5600000000000000000000000000", 0x0D54).SendRaw(connection);
			// SMSG_EnterPlayerCharacterToField
			new SpRaw("8CEB454FD7946A00000000000100019CB300009EF8C700E08AC480C6D647046788BE0000000080BF763F030000000000803F000039438CE9FFFFFFFFFFFF8CE9FFFFFFFFFFFF02946DE49500000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006B0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000781800000000000000000000000000000000000000000000000000000000000058E10000000000000000000000000000000000000000000000000000000000000B00000000000000000000000000000000000000000000000000000000000000EAE1000000000000000000000000000000000000000000000000000000000000386C000000000000000000000000000000000000000000000000000000000000EAE10000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000F3FF000000000000000000000000000000000000000000000000000000000000C020000000000000000000000000000000000000000000000000000000000000F8FF00000000000000000000000000000000000000000000000000000000000040E2000000000000000000000000000000000000000000000000000000000000689700000000000000000000000000000000000000000000000000000000000064000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000F8FF000000000000000000000000000000000000000000000000000000000000EAE1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006445030000000000020000008CEB454FD7946A00010000000100000004000000110000000000000000000000000000A128000000FCFFFF000000000000250000000000000000000000000584000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000FCFFFF010600000000000000030000000000000000000000000000000000000000000000BC3900000000000000000000000000000000000000FCFFFF00000000000000000000000000FCFFFF0000000000000000000000000200000000000000000000000000020000004300680061006F007300470061006D006500730000000000000000000000000000000000000000000000000000000000000000000000000000000000000063006C0065006F0063006C0065006F0063006C0065006F000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000052006500640042006C006F006F0064006500640057006F006D0061006E00000000000000000000000000000000000000000000000000000000000000000000060000000004000000A1280000FFFFFFFFFFFFFFFF3200FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF0005290000FFFFFFFFFFFFFFFF3200FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF0000000000FEFFFFFFFFFFFFFF0000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF0000000000FEFFFFFFFFFFFFFF0000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF0000000000FEFFFFFFFFFFFFFF0000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF0000000000FEFFFFFFFFFFFFFF0000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF0000000000FEFFFFFFFFFFFFFF0000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF0000000000FEFFFFFFFFFFFFFF0000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF0000000000FEFFFFFFFFFFFFFF0000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF0000000000FEFFFFFFFFFFFFFF0000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF0000000000FEFFFFFFFFFFFFFF0000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF0000000000FEFFFFFFFFFFFFFF0000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF0000000000FEFFFFFFFFFFFFFF0000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF0000000000FEFFFFFFFFFFFFFF0000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF0000000000FEFFFFFFFFFFFFFF0000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF0000000000FEFFFFFFFFFFFFFF0000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF0000000000FEFFFFFFFFFFFFFF0000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF0000000000FEFFFFFFFFFFFFFF0000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF0000000000FEFFFFFFFFFFFFFF0000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF0000000000000000010000000000000020000000170000000000000000000000A8E8EEF71700000040A600000000000040A60000000000007038430B000000000000000000000000000000000000000000000000180000002900000000000000FFFFFF7F0000000080F84D0B00000000A012A485FE7F0000A009B95A140000000000000000000000080000000000000060A0B95A1400000004A4000000000000B0F6A485FE7F000004A400000000000060E364F117000000001000000000000054E9EEF717000000B8E9EEF71700000000000000000000000000000000000000B0E8D4080000000050E9EEF71700000060E364F1170000000000000029000000A0E8D40800000000B07AF800000000000010000017000000A009B95A14000000A0E8D408000000000800000000000000000000000000000000000000000000007912C46CFE7F0000E09CB95A1400000059EAEEF717000000000000000000000000000000000000000400000000000000000000000000000020EAEEF7170000000000000000000000000000000000000086020000FE7F00000010B95A14000000A0EBEEF7170000002900000000000000FFFFFF7FFFFFFF7FA009B95A1400000007E3E1060000000000000000140000008602000000000000860200000000000001000000FE7F00000100000030750000E803000017000000EE72398E4E7D000001000000FFFFFF7F88EAEEF717000000E09CB95A14000000B019B95A14000000A009B95A14000000A0EBEEF717000000C0205CF1170000000000000000000000860200000000000086020000000000008F96CC6CFE7F000000000000000000008602000000000000860200000000000000000000000000000000B95A14000000A0EBEEF717000000C0205CF117000000C0DAB95A140000000000000000000000C0DAB95A14000000E09CB95A1400000000000000000000000100000000000000E92BCC0700FCFFFF1F000000000000001F0000000000000000000000000000001F000000000000000000000000000000000000000000FEFF00", 0x0CE4).SendRaw(connection);
			// SMSG_LoadField
			new SpRaw("", 0x0CFE).SendRaw(connection);
			// SMSG_VariExtendSlot
			new SpRaw("010000", 0x1164).SendRaw(connection);
			// SMSG_SkillList
			new SpRaw("0108270001004905000100890600010088060001008A020001008A06000100170400010087060001007E02000100BE04000100DD000001001D040001002504000100230400010016040001008405000100860200010086050001008305000100B1020001008D020001008C020001004F05000100CF000001008F020001008E02000100CB000001008B0200010081020001008002000100900200010093020001007F020001005C00000100DC00000100DE0000010058000001007C010001002004000100180400", 0x0D15).SendRaw(connection);
			// SMSG_SkillAwakenList
			new SpRaw("0000", 0x113E).SendRaw(connection);
			// SMSG_InventorySlotCount
			new SpRaw("12", 0x0C47).SendRaw(connection);
			// SMSG_AddItemToInventory
			new SpRaw("0101019CB3000000000000000000000000000800000001000000B80B000000000000FFFFFFFFFFFFFFFF0000000000000000000100FF7FFF7F7A241551D7946A00FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00000000000000000000000000000000000000000000000000000000000002F60100000B00000000000000FFFFFFFFFFFFFFFF0100000000000000000100FF7FFF7F181B1551D7946A00FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00000000000000000000000000000000000000000000000000000000000003FFAC00000900000000000000FFFFFFFFFFFFFFFF0000000000000000000100FF7FFF7FA8391551D7946A00FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00000000000000000000000000000000000000000000000000000000000004113F0000010000000000000008F0EA560000000000000000000000000001000A000A005D041551D7946A00FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF0000000000000000000000000000000000000000000000000000000000000500AD00000700000000000000FFFFFFFFFFFFFFFF0000000000000000000100FF7FFF7F4F461551D7946A00FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00000000000000000000000000000000000000000000000000000000000006F70100000E00000000000000FFFFFFFFFFFFFFFF0100000000000000000100FF7FFF7FF5471551D7946A00FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00000000000000000000000000000000000000000000000000000000000007DC0000000200000000000000FFFFFFFFFFFFFFFF0000000000000000000100FF7FFF7FEA0E5251D7946A00FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00000000000000000000000000000000000000000000000000000000000008FD2300000300000000000000FFFFFFFFFFFFFFFF0000000000000000000100FF7FFF7FEB0E5251D7946A00FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF0000000000000000000000000000000000000000000000000000000000", 0x0BF1).SendRaw(connection);
			new SpRaw("0101019CB3000000000000000000000000000200100107000000C800000000000000FFFFFFFFFFFFFFFF0000000000000000000100FF7FFF7F810E5251D7946A00FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000000000000000000000000000000000000000000000000000000010026E4200000100000000000000FFFFFFFFFFFFFFFF0000000000000000000100FF7FFF7FEC0E5251D7946A00FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF0000000000000000000000000000000000000000000000000000000000", 0x0BF1).SendRaw(connection);
			// SMSG_GetAllEquipSlot
			new SpRaw("01A12800000100000000000000FFFFFFFFFFFFFFFF0000000000000000000100320032005B041551D7946A00FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF0000000000000000000000000000000000000000000000000000000000052900000100000000000000FFFFFFFFFFFFFFFF0000000000000000000100320032005C041551D7946A00FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF0000000000000000000000000000000000000000000000000000000000000000000028D1EEF71700000040A600000000000040A60000000000000000430B0000FFFFFFFFFFFFFFFF0000000000000000000000000000000000003700000000000000FFFFFF7F1000000040B64D0B00000000A012A485FE7F0000A0099900000000000000000000000000080000000000000060A099F310000000000000000000FFFFFFFFFFFFFFFF000054A2000000000000304262F1170000000010000000000000D4D1EEF71700000038D2EEF71700000000000000000000000000000000000000B0E8D40800000000D0D1EEF717000000304262F117000000000000003700FFFFFFFFFFFFFFFF0000B07AF800000000000010000017000000A00999F310000000A0E8D408000000000800000000000000000000000000000000000000000000007912C46CFE7F0000E09C99F310000000D9D2EEF717000000000000000000FFFFFFFFFFFFFFFF000004000000000000000000000000000000A0D2EEF717000000000000000000000000000000000000007A000000FE7F0000001099000000000020D4EEF7170000003700000000000000FFFFFF7FFFFFFF7F000099F31000FFFFFFFFFFFFFFFF000000000000100000007A000000000000007A0000000000000001000000100000000100000030750000E8030000100000006E49390000000000010000001700000008D3EEF717000000E09C99F310000000000099F31000FFFFFFFFFFFFFFFF000020D4EEF717000000F0805CF11700000000000000000000007A000000000000007A000000000000008F96CC6CFE7F0000F0805C00000000007A000000000000007A0000000000000000000000000000000000E7F51700FFFFFFFFFFFFFFFF0000F0805CF1170000002008E7F51700000000000000000000002008E7F517000000E09C99F31000000000000000000000000100000000000000E92BCC6CFE7F0000F0805CF1170000007A00000000000000000000000000FFFFFFFFFFFFFFFF00007A005CF11700000003D4EEF7170000007A8320CD2ABC000020D4EEF7170000002008E7F51700000038000000000000004000000000000000F0805CF1170000000000000000000000E9D4EEF717000000000000000000FFFFFFFFFFFFFFFF0000F0805CF117000000000000000000000044E3D1F5170000000000000000000000000000000000000003805CF1170000000200000000000000C07402F61700000000000000000000004000000017000000000000000000FFFFFFFFFFFFFFFF00000000000000000000806E02F6170000000000000000000000000000000000000044E3D1F51700000040000000000000000000000000000000D0DAFDF51700000038000000000000000000000000000000000000000000FFFFFFFFFFFFFFFF00000000000000000000010000000000000001000000000000000F20D46CFE7F0000000000000000000090D5EEF7170000002008E70000000000FCE4CC6CFE7F00002008E7F5170000000000000000000000000000000000FFFFFFFFFFFFFFFF00002008E7F517000000AF32D36CFE7F0000000000000000000044E3D1F5170000002008E7F5170000000000CC6CFE7F00002008E70000000000FCE4CC6CFE7F0000103F91F017000000A633106FFE7F0000000000000000FFFFFFFFFFFFFFFF0000FFFFFFFFFFFFFFFF00000000000000000200000000000000C0E995CC170000000000000000000000F624106FFE7F0000103F910000000000C0E995CC1700000000D6EEF717000000C0E995CC17000000000091F01700FFFFFFFFFFFFFFFF00000000000000000000903F7B0101000000B0B024A5F67F0000306E24A5F67F00000100000000000000403599F317000000A20D00000000000000FF00FFF67F0000000000000000000002000002170000000000FFFFFFFFFFFFFFFFFFFFFFFF0000EEFEEEFEEEFEEEFE0017B3061A0000001044CC02000000003C7AB287FE7F00005001CC02000000005037BC331A00000000003A00000000000000CC02000000005007000000000000E08401A4F67F0000000000000000FFFFFFFFFFFFFFFF00005037BC331A000000FF0300FC000000000100000001000000C40D00C90000000000000000000000001044CC0200000000FFFFFF00000000000017B3061A00000050070000000000005037BC331A0000000000CC020000FFFFFFFFFFFFFFFF000090D7EEF717000000090000000000000000000000000000000000000000000000800000000000000050070057FE7F00000000B90000000000000000000000000080000000000000000000000000000000000000000000FFFFFFFFFFFFFFFF000000FF00FF00000000D854B287FE7F000001000000000000001044CC020000000000000000000000004017B3061A000000709EBC00000000005037BC331A0000000000000000000000495FB287FE7F0000000000000000FFFFFFFFFFFFFFFF0000500700000000000000A6AEA4F67F0000FF030000000000005044CC02000000007207FFFFF67F0000C02261A6000000000101FF000000000000060000FE7F000001D1EE00000000005007000000000000000000000000FFFFFFFFFFFFFFFF0000B0FCA493160000001F20010001000000DE0000000000000018000000F67F0000DE00000000000000FF0300000D0000000000000000000000D854B287FE7F000000000000000000001036749D020000000000E4040000FFFFFFFFFFFFFFFF0000DE0000DE00000000DE0000DE020000006500540400000000D854B287FE7F00000000000000000000DE0000000000000083000000000000006037BC331A0000000000000000000000010000000000000000001AA5F67FFFFFFFFFFFFFFFFF00006832749D0200000047545484FE7F000020A849D90B000000948D12730000000010670000000000007D08B287FE7F00006832740000000000DE00000000000000000000001700000018000000F67F0000000000000000FFFFFFFFFFFFFFFF0000000000000000000000000000000000000000000000000000A032749D02000000010000000200000000000000F67F000000000000000000006832749D020000007038430B000000006832749D020000000000E1060000FFFFFFFFFFFFFFFF000050BD3C7601000000A012A485FE7F000075C099C1020000000000CC0200000000000000000000000010000000000000005037BC0000000000A854B287FE7F00000000CC02000000006037BC331A000000000000000000FFFFFFFFFFFFFFFF000000000000010000006832749D0200000000000000000000006AFEEAA4F67F000050DAEEF71700000003000000020000000000000000000000A0E8D4080000000075C099C102000000ABDAE3A4F67F0000000000000000FFFFFFFFFFFFFFFF0000903F7B010100000099DBEEF71700000058DBEEF717000000948D12730000000000000000000000006832749D020000000000000000000000100000000000000058DBEEF7170000007A26E2A4F67F00000000BC331A00FFFFFFFFFFFFFFFF0000C400000000000000903F7B0101000000FEFFFFFFFFFFFFFF709EBC331A000000709EBC331A000000B5AE91A4F67F000058DBEE0000000000709EBC331A000000F10B7B010100000099DBEEF717000000000099C10200FFFFFFFFFFFFFFFF0000000000000000000000E1F505F10B000040060000000000000000000000000000000000000000000000000000000000000000000000000000BFC200000000000000000000000000000000000000000000000000000000FFFFFFFFFFFFFFFF0000903F7B0101000000FEFFFFFFFFFFFFFF0000000000000000B3E3E10600000000903F7B01010000000000000000000000000000", 0x0D67).SendRaw(connection);
			// SMSG_LifeExperienceInformation * 9
			new SpRaw("00010000000000000000000000", 0x1089).SendRaw(connection);
			new SpRaw("01010000000000000000000000", 0x1089).SendRaw(connection);
			new SpRaw("02010000000000000000000000", 0x1089).SendRaw(connection);
			new SpRaw("03010000000000000000000000", 0x1089).SendRaw(connection);
			new SpRaw("04010000000000000000000000", 0x1089).SendRaw(connection);
			new SpRaw("05010000000000000000000000", 0x1089).SendRaw(connection);
			new SpRaw("06010000000000000000000000", 0x1089).SendRaw(connection);
			new SpRaw("07010000000000000000000000", 0x1089).SendRaw(connection);
			new SpRaw("08010000000000000000000000", 0x1089).SendRaw(connection);
			// SMSG_PaymentPassword
			new SpRaw("0077E6EA56000000000747F8593300000000D2DA91B4000000004FEC1DD201000000C3615D160100000021E9FFAB0100000058B599E40100000099747B61000000002991FDF500000000C39B5DDE01000000EFA508A1000000009F4D912C01000000D0E7FC420200000081E2840E000000008929F016010000009948079101000000181BC443010000007728217800000000CB8591F8000000001140914802000000F34B1BA401000000.", 0x0CDF).SendRaw(connection);
			// SMSG_ListFitnessExperience
			new SpRaw("00000000010000000E01000000000000010000000100000000000000000000000200000001000000000000000000000000000000000000000000000000000000", 0x108B).SendRaw(connection);
			// SMSG_SetCharacterLevels
			new SpRaw("8CE9FFFFFFFFFFFF8CE9FFFFFFFFFFFF019CB30006000000BA00000000000000D701000000000000000000000000000000", 0x0F80).SendRaw(connection);
			// SMSG_SetCharacterPrivatePoints
			new SpRaw("019CB300707B19000000000000007A440000000000000000000000000000400D0300400D0300400D0300400D0300", 0x0F7A).SendRaw(connection);
			// SMSG_SetCharacterStats
			new SpRaw("01019CB3000000E0400000E0400000284100006041000060400000000000000000707B190000000000010000000000C040030000000000000040420F00000000000000000000000000", 0x0F7D).SendRaw(connection);
			// SMSG_SetCharacterSpeeds
			new SpRaw("000000000000000000000000", 0x0F7F).SendRaw(connection);
			// SMSG_SetCharacterSkillPoints
			new SpRaw("0100050008008C080000", 0x0F82).SendRaw(connection);
			// SMSG_SetCharacterProductSkillPoints
			new SpRaw("0000000000000000", 0x0F86).SendRaw(connection);
			// SMSG_UpdateStamina
			new SpRaw("02E8030000C8000000E8030000", 0x0EBE).SendRaw(connection);
			// SMSG_SetCharacterStatPoint
			new SpRaw("019CB3000500000005000000050000000A0000000A0000000A0000000000000005000000000000000500000000000000050000000000000005000000", 0x0F7C).SendRaw(connection);
			// SMSG_QuickSlotList
			new SpRaw("8CEB454FD7946A0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000", 0x0D2C).SendRaw(connection);
			// SMSG_ListQuestSelectType
			new SpRaw("00000000000000000000000000000000000000000000000000", 0x0E88).SendRaw(connection);
			// SMSG_ListQuestSortType
			new SpRaw("00000000000000000000", 0x0E8B).SendRaw(connection);
			// SMSG_SetMurdererState
			new SpRaw("019CB3000000000000000000", 0x0D44).SendRaw(connection);
			// SMSG_ExplorePointList
			new SpRaw("01000000000000000A00000000000000", 0x0E9B).SendRaw(connection);
			// SMSG_SupportPointList
			new SpRaw("01000000000000000100000000000000", 0x0EC0).SendRaw(connection);
			// SMSG_ProgressingQuestList
			new SpRaw("02009E000400000000000000000000000000000000000000000077FDE6560000000092010100000000000000000000000000000000000000000078FDE65600000000", 0x0E5C).SendRaw(connection);
			// SMSG_ClearedQuestList
			new SpRaw("0C00F701010000000000000000009F00010000000000000000009E00010000000000000000009F00020000000000000000009F0003000000000000000000E9036B0000000000000000009F00040000000000000000009F00050000000000000000009F00060000000000000000009F00070000000000000000009E00030000000000000000009E0002000000000000000000", 0x0E5D).SendRaw(connection);
			// SMSG_ListCheckedQuest
			new SpRaw("3530332C302C3135382C342C3430322C312C00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000", 0x0E5E).SendRaw(connection);
			// SMSG_UpdateTitleKey
			new SpRaw("00000000019CB300", 0x0CE2).SendRaw(connection);
			// SMSG_ListIntimacy
			new SpRaw("1900FD9E01000000659C01000000FE9E010000009E9E01000000669C01000000039F010000009B9E01000000FF9E01000000029F01000000049F01000000059F01000000069F01000000089F01000000099F010000000A9F010000000B9F010000000C9F010000000D9F0A0000000E9F01000000109F01000000119F01000000129F01000000139F01000000149F010000007CC501000000", 0x0EC2).SendRaw(connection);
			// SMSG_ExplorationInfo
			new SpRaw("000006003D00000001000000000000000000400000000000000000000000000042000000000000000000000000006C00000000000000000000000000C900000000000000000000000000CB00000000000000000000000000", 0x0E9D).SendRaw(connection);
			// SMSG_UpdateExplorationPoint
			new SpRaw("0000", 0x0EA0).SendRaw(connection);
			// SMSG_PlantInfo
			new SpRaw("0000", 0x0EC7).SendRaw(connection);
			new SpRaw("0000", 0x0EC7).SendRaw(connection);
			new SpRaw("0000", 0x0EC7).SendRaw(connection);
			// SMSG_ReservedLearningSkill
			new SpRaw("000000000300000000000000", 0x0D31).SendRaw(connection);
			// SMSG_ListHouseForTownManagement
			new SpRaw("0000", 0x0E8E).SendRaw(connection);
			// SMSG_ListHouseLargeCraft
			new SpRaw("0000", 0x0E8F).SendRaw(connection);
			// SMSG_SetWp
			new SpRaw("20001E00", 0x0C6F).SendRaw(connection);
			// SMSG_ListMyVendor
			new SpRaw("0000", 0x0FE6).SendRaw(connection);
			// SMSG_ListProgressChallenge
			//new SpRaw("000000", 0x10CA).SendRaw(connection);
			// SMSG_ListCompleteChallenge
			//new SpRaw("000000", 0x10CB).SendRaw(connection);
			// SMSG_ListPalette
			new SpRaw("01000000", 0x0C2B).SendRaw(connection);
			// SMSG_AddPlayers
			new SpRaw("010000010100019CB300009EF8C700E08AC480C6D647046788BE0000000080BF763F0300000000003943000039438CE9FFFFFFFFFFFF8CE9FFFFFFFFFFFF00946DE4950000000000000000000000000000000003000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003E2A0000000000000000000000000000000000000000000000000000000000FFFFFF0000000000000000000000000000000000000000000000000000000000FFFFFF0000000000000000000000000000000000000000000000000000000000FFFFFF0000000000000000000000000000000000000000000000000000000000FFFF58000000000000000000000000000000000000000000000000000000000000FEFF0000000000000000000000000000000000000000000000000000000000FFFFFF0000000000000000000000000000000000000000000000000000000000FFFFFF0000000000000000000000000000000000000000000000000000000000FFFFFF0000000000000000000000000000000000000000000000000000000000FFFFFF0000000000000000000000000000000000000000000000000000000000FFFFFF00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000FFFFFF0000000000000000000000000000000000000000000000000000000000FFFFFF0000000000000000000000000000000000000000000000000000000000FFFFFF0000000000000000000000000000000000000000000000000000000000FF00000000000000000000000000000000000000000000000000000000000000FEFFFF0000000000000000000000000000000000000000000000000000000000FFFF000000000000000000000000000000000000000000000000000000000000FFFFFF0000000000000000000000000000000000000000000000000000000000FFFFFF00000000000000000000000000000000000000000000000000000000000B00000000000000000000000000000000000000000000000000000000000000AC15040000000000000000000000000000000000000000000000000000000000AC634600000000000000000000000000000000000000000000000000000000004F06000000000000000000000000000000000000000000000000000000000000034F060000000000000000006445030000000000020000008CEB454FD7946A00010000000100000004000000110000000000000000000000000000A128000000FCFFFF000000000000250000000000000000000000000584000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000FCFFFF010600000000000000030000000000000000000000000000000000000000000000BC3900000000000000000000000000000000000000F8FFFF00000000000000000000000000F8FFFF0000000000000000000000000200000000000000000000000000", 0x0BB9).SendRaw(connection);
			// SMSG_ChargeUser
			new SpRaw("000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000", 0x0C0A).SendRaw(connection);
			// SMSG_PlayerLogOnOff
			new SpRaw("019CB30064450300000000008CEB454FD7946A0077E6EA560000000000000000000000002000000052006500640042006C006F006F0064006500640057006F006D0061006E000000000000000000000000000000000000000000000000000000000000000000060000008CE9FFFFFFFFFFFF4300680061006F007300470061006D0065007300000000000000000000000000000000000000000000000000000000000000000000000000000000000000E2000300", 0x0D47).SendRaw(connection);
			// SMSG_AddGuildHouseCraftList
			new SpRaw("8CE9FFFFFFFFFFFF0000", 0x1010).SendRaw(connection);
			// SMSG_DailyWorkingCountList
			new SpRaw("8CE9FFFFFFFFFFFF0000", 0x1012).SendRaw(connection);
			// SMSG_SetMyHouseForTownManagement
			new SpRaw("00000000000000000000010100", 0x0E96).SendRaw(connection);
			// SMSG_MaidInfoTotal
			new SpRaw("0000", 0x0FBB).SendRaw(connection);
			// SMSG_SetSubResourcePoints
			new SpRaw("019CB30000000000000000000000204100000000", 0x0F77).SendRaw(connection);
			// SMSG_SetCharacterPublicPoints
			new SpRaw("8CE9FFFFFFFFFFFF8CE9FFFFFFFFFFFF019CB300000000000000000000003A4300003A4300003A4300FCFFFF", 0x0F72).SendRaw(connection);
			// SMSG_SetCharacterRelatedPoints
			new SpRaw("8CE9FFFFFFFFFFFF8CE9FFFFFFFFFFFF019CB3000000000000000000A3000000A3000000A300000000", 0x0F73).SendRaw(connection);
			// SMSG_LoadCustomizedKeys
			new SpRaw("0100000000FF0000FF0000FF0000FF0000FF0000FF0000FF0000FF0000FF0000FF0000FF0000FF0000FF0000FF0000FF0000FF0000FF0000FF0000FF0000FF0000FF0000FF0000FF0000FF0000FF0000FF0000FF0000FF0000FF0000FF0000FF0000FF0000FF0000FF0000FF0000FF0000FF0000FF0000FF0000FF0000FF0000FF0000FF0000FF0000FF0000FF0000FF0000FF0000FF0000FF0000FF0000FF0000FF0000FF0000FF0000FF0000FF0000FF0000FF0000FF0000FF0000FF0000FF0000FF0000FF0000FF0000FF0000FF0000FF0000FF000000FF000000FF000000FF000000FF000000FF000000FF000000FF000000FF000000FF000000FF000000FF000000FF000000FF000000FF000000FF000000FF000000FF000000FF000000FF000000FF000000FF000000FF000000FF000000FF000000FF000000FF000000FF000000FF000000FF000000FF000000FF000000FF000000FF000000FF000000FF000000FF000000FF000000FF000000FF000000FF000000FF000000FF000000FF000000FF000000FF000000FF000000FF000000FF000000FF000000FF000000FF000000FF000000FF000000FF000000FF000000FF000000FF000000FF000000FF000000FF000000FF000000FF000000FF000000FF000000FF000000FF000000FF000000FF000000FF000000FF", 0x10B6).SendRaw(connection);
			// SMSG_BidTerritoryTradeAuthority
			new SpRaw("00000000FFFFFFFFFFFFFFFFFFFF00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000", 0x0F4F).SendRaw(connection);
			// SMSG_SupplyTerritoryStart
			new SpRaw("00000000000000000000000000", 0x0F99).SendRaw(connection);
			// SMSG_LoadFieldComplete
			new SpRaw("", 0x0CFF).SendRaw(connection);
			// SMSG_EnterPlayerCharacterToFieldComplete
			new SpRaw("0101010200000001", 0x0CE5).SendRaw(connection);
			// SMSG_EnablePvP
			new SpRaw("019CB3000000", 0x0D41).SendRaw(connection);
			// SMSG_EnableAdrenalin
			new SpRaw("00", 0x0D45).SendRaw(connection);
			// SMSG_NotifyVariableTradeItem
			new SpRaw("0000000080841E0080841E0080841E0080841E0080841E0080841E0080841E0080841E0080841E0007A1FFFF38000100", 0x0C54).SendRaw(connection);
			// SMSG_GetAuctionTime
			new SpRaw("675C9D5F00000000", 0x0F05).SendRaw(connection);
			// SMSG_UpdateAccessibleServer
			new SpRaw("2601E20077E6EA560000000000EAEA5600000000", 0x10C7).SendRaw(connection);
			*/
		}

		public void PrepareForEnterOnWorld(ClientConnection connection, long characterId)
        {
			/*
            var player = new Player(connection, connection.Characters.First(s => s.CharacterId == characterId))
            {
                GameSessionId = _gameSessionFactory.Next(),
            };

            using (var db = _gsDbFactory.OpenSession())
            {
                var daoItems = db.QueryOver<CharacterItem>().Where(i => i.CharacterId == characterId).List();
                var items = new List<CharacterItem>();
                var equipItems = new List<CharacterItem>();

                foreach (var it in daoItems)
                {
                    if (it.StorageType == (int) StorageType.Equipment)
                        equipItems.Add(it);
                    if (it.StorageType == (int) StorageType.Inventory)
                        items.Add(it);
                }
                
                player.Inventory = new InventoryStorage(items.ToDictionary<CharacterItem, short, AStorageItem>(e => (short)(e.Slot + 1), e => new InventoryItem(e.ItemId, e.Count) {StorageType = (StorageType) e.StorageType}), 48);
                player.Equipment = new EquipmentStorage(equipItems.ToDictionary<CharacterItem, short, AStorageItem>(e => (short)(e.Slot + 1), e => new InventoryItem(e.ItemId, e.Count) {StorageType = (StorageType) e.StorageType}), 48);
            }

            connection.ActivePlayer = player;
            connection.ActivePlayer.PlayerActions += (action, parameters) =>
            {
                switch (action)
                {
                    case Player.PlayerAction.Logout:
                        if (connection.ActivePlayer != null)
                        {
                            UpdateCharacter(connection);
                            _gameSessionFactory.ReleaseUniqueInt(connection.ActivePlayer.GameSessionId);
                        }
                        break;                       
                }
            };

            var sessionId = BitConverter.GetBytes(connection.ActivePlayer.GameSessionId).ToHex();

			// SMSG_CancelFieldEnterWaiting
			new SpRaw("000000000000000000000000", 0x0CF4).SendRaw(connection);
			// SMSG_RefreshGuildSeqNo
			new SpRaw("3401620010FC266F38020100000000000000630010FC266F38020100000000000000680010FC266F380201000000000000006E0010FC266F38020100000000000000720010FC266F38020100000000000000850010FC266F38020100000001000000960010FC266F380201000000000000009E0010FC266F38020100000000000000AD0010FC266F38020100000000000000AE0010FC266F38020100000000000000AF0010FC266F38020100000000000000B00010FC266F38020100000000000000B20010FC266F38020100000000000000B30010FC266F38020400000001000000BA0010FC266F38020100000000000000C30010FC266F38020100000000000000C80010FC266F38020100000000000000CA0010FC266F38020100000000000000CF0010FC266F38020100000000000000D70010FC266F38020100000000000000DB0010FC266F38020100000001000000DD0010FC266F38020100000001000000E20010FC266F38020100000000000000E30010FC266F38020100000001000000E50010FC266F38020100000000000000E70010FC266F38020100000000000000E80010FC266F38020100000000000000EA0010FC266F38020100000000000000EC0010FC266F38020100000000000000EE0010FC266F38020100000000000000F80010FC266F38020100000001000000FB0010FC266F38020100000000000000100110FC266F38020100000000000000160110FC266F38020100000000000000180110FC266F38020100000001000000190110FC266F380201000000000000001A0110FC266F380201000000000000001E0110FC266F38020100000000000000250110FC266F38020100000001000000280110FC266F380201000000000000002D0110FC266F38020100000000000000330110FC266F38020100000000000000340110FC266F38020100000000000000350110FC266F38020100000000000000370110FC266F38020100000000000000390110FC266F380201000000000000003B0110FC266F380201000000000000003D0110FC266F38020100000000000000440110FC266F380201000000000000004F0110FC266F38020100000000000000560110FC266F380201000000000000005B0110FC266F380201000000010000005C0110FC266F380201000000000000005E0110FC266F38020100000001000000600110FC266F38020100000001000000640110FC266F38020100000000000000650110FC266F38020100000000000000680110FC266F380201000000000000006B0110FC266F380201000000000000006C0110FC266F38020100000001000000710110FC266F38020100000000000000730110FC266F38020100000000000000740110FC266F38020100000000000000770110FC266F38020100000000000000790110FC266F38020100000000000000800110FC266F38020200000001000000840110FC266F38020100000000000000900110FC266F38020100000000000000950110FC266F38020100000000000000960110FC266F380201000000000000009D0110FC266F38020100000001000000A00110FC266F38020100000000000000AC0110FC266F38020100000000000000AE0110FC266F38020100000000000000AF0110FC266F38020100000000000000C00110FC266F38020100000000000000C30110FC266F38020100000000000000C40110FC266F38020100000000000000C70110FC266F38020E00000001000000C90110FC266F38022600000004000000CD0110FC266F38020300000000000000D00110FC266F38020100000000000000D10110FC266F38020100000000000000DA0110FC266F38020100000000000000E60110FC266F38020100000001000000F00110FC266F38020100000000000000F60110FC266F38020100000000000000FC0110FC266F38020100000000000000FD0110FC266F38020100000000000000010210FC266F380201000000000000000D0210FC266F38020100000000000000140210FC266F38020600000000000000190210FC266F380201000000000000001A0210FC266F380201000000000000001B0210FC266F380201000000000000001C0210FC266F380201000000000000001E0210FC266F38020100000000000000200210FC266F38020100000000000000230210FC266F38020100000000000000250210FC266F38021A00000015000000260210FC266F380205000000000000002C0210FC266F38020100000001000000350210FC266F38020100000000000000470210FC266F3802D704000006000000490210FC266F380201000000000000004A0210FC266F380201000000000000004B0210FC266F380201000000000000004D0210FC266F38020100000000000000520210FC266F38020100000000000000580210FC266F38020100000001000000590210FC266F380201000000000000005D0210FC266F38020100000001000000620210FC266F38020100000000000000640210FC266F38020100000000000000650210FC266F38020100000000000000670210FC266F38020100000001000000680210FC266F380201000000000000006A0210FC266F380201000000000000006F0210FC266F38020100000000000000770210FC266F38020D000000010000007B0210FC266F380201000000000000007E0210FC266F38020200000001000000820210FC266F38020100000001000000870210FC266F38020100000000000000880210FC266F38020100000000000000960210FC266F38021B00000002000000970210FC266F38020100000000000000A20210FC266F38020100000000000000A30210FC266F38020100000000000000AA0210FC266F38020100000000000000B60210FC266F38020100000000000000BD0210FC266F38020100000000000000BE0210FC266F38020100000000000000C40210FC266F38020100000000000000C50210FC266F38020100000001000000C70210FC266F38020100000000000000D00210FC266F38020100000001000000D40210FC266F38020100000001000000D60210FC266F38020100000000000000DA0210FC266F38020100000000000000ED0210FC266F38020100000000000000EF0210FC266F38020100000001000000F00210FC266F38020100000000000000F30210FC266F38020100000000000000000310FC266F38020100000000000000010310FC266F38020100000000000000020310FC266F38020100000000000000060310FC266F38020100000000000000080310FC266F380201000000000000000B0310FC266F380211000000010000000C0310FC266F380235000000010000000D0310FC266F380201000000000000000E0310FC266F380201000000010000001C0310FC266F38020100000001000000200310FC266F38020100000000000000250310FC266F38020100000000000000260310FC266F380201000000000000002D0310FC266F38020100000000000000310310FC266F38020100000000000000390310FC266F380201000000000000003B0310FC266F38020100000000000000420310FC266F38020500000001000000430310FC266F38020100000000000000460310FC266F38020100000000000000470310FC266F38020100000000000000490310FC266F380201000000000000004B0310FC266F38020100000000000000520310FC266F38020600000000000000530310FC266F38020100000000000000560310FC266F380201000000000000005D0310FC266F38020100000000000000600310FC266F38020100000000000000630310FC266F38020100000000000000660310FC266F38020100000000000000670310FC266F380201000000000000006B0310FC266F380201000000000000006D0310FC266F380201000000010000006E0310FC266F380201000000000000006F0310FC266F38020100000000000000720310FC266F38020100000000000000730310FC266F38020100000000000000740310FC266F38020100000000000000770310FC266F38020100000000000000780310FC266F38020200000001000000790310FC266F380201000000000000007A0310FC266F38020300000000000000810310FC266F38020100000000000000840310FC266F380201000000000000008A0310FC266F380201000000000000008E0310FC266F38020100000000000000A20310FC266F38020100000000000000A70310FC266F38020200000000000000AE0310FC266F38020200000001000000AF0310FC266F38020100000000000000B00310FC266F38020100000000000000B20310FC266F38020100000001000000BC0310FC266F38020100000000000000C10310FC266F38020100000000000000C30310FC266F38020100000000000000C70310FC266F38020100000000000000C90310FC266F38020100000000000000D00310FC266F38020100000000000000D10310FC266F38020200000001000000D50310FC266F38020100000000000000D90310FC266F38020100000000000000E10310FC266F38020100000000000000E40310FC266F38020100000000000000E60310FC266F38020100000000000000EC0310FC266F38020100000000000000EE0310FC266F38020100000000000000F20310FC266F38020100000000000000F30310FC266F38020100000000000000F40310FC266F38020100000000000000F60310FC266F38020100000000000000F80310FC266F38020100000000000000010410FC266F380201000000000000000E0410FC266F38020100000001000000130410FC266F38020100000001000000150410FC266F38020100000000000000180410FC266F380224000000040000001D0410FC266F380201000000000000001F0410FC266F38020100000000000000210410FC266F38020100000000000000280410FC266F38020100000000000000320410FC266F38020100000000000000350410FC266F38020100000000000000380410FC266F38028C000000050000003D0410FC266F380201000000000000003E0410FC266F38020100000000000000400410FC266F38020100000000000000981BC9ED85BE3F0101000000000000009A1BC9ED85BE3F0108000000030000009B1BC9ED85BE3F010100000000000000A21BC9ED85BE3F010100000000000000AC1BC9ED85BE3F010100000000000000AD1BC9ED85BE3F010400000000000000AE1BC9ED85BE3F010100000000000000B11BC9ED85BE3F010100000000000000B61BC9ED85BE3F010100000000000000BA1BC9ED85BE3F010700000000000000C51BC9ED85BE3F010100000000000000C61BC9ED85BE3F010100000003000000C71BC9ED85BE3F010100000000000000C81BC9ED85BE3F010100000000000000CA1BC9ED85BE3F010200000000000000D81BC9ED85BE3F010100000000000000DB1BC9ED85BE3F010100000000000000E21BC9ED85BE3F011200000000000000E71BC9ED85BE3F010300000000000000ED1BC9ED85BE3F010400000000000000EE1BC9ED85BE3F010100000000000000F01BC9ED85BE3F010100000000000000F31BC9ED85BE3F010100000000000000F41BC9ED85BE3F010400000000000000F91BC9ED85BE3F010300000000000000051CC9ED85BE3F010200000000000000081CC9ED85BE3F010100000000000000091CC9ED85BE3F010C000000000000000D1CC9ED85BE3F0101000000000000000E1CC9ED85BE3F010400000000000000121CC9ED85BE3F0103000000000000001B1CC9ED85BE3F0102000000000000001C1CC9ED85BE3F0101000000000000001D1CC9ED85BE3F0102000000000000001E1CC9ED85BE3F010100000000000000261CC9ED85BE3F010100000000000000291CC9ED85BE3F010100000000000000331CC9ED85BE3F010200000000000000361CC9ED85BE3F010200000000000000381CC9ED85BE3F0102000000000000003A1CC9ED85BE3F0102000000000000003B1CC9ED85BE3F0105000000000000003C1CC9ED85BE3F010200000000000000411CC9ED85BE3F010100000000000000451CC9ED85BE3F0101000000000000004A1CC9ED85BE3F0102000000000000004B1CC9ED85BE3F0104000000000000004F1CC9ED85BE3F010100000000000000521CC9ED85BE3F010100000000000000531CC9ED85BE3F010100000000000000551CC9ED85BE3F010200000000000000561CC9ED85BE3F010100000000000000581CC9ED85BE3F0101000000000000005B1CC9ED85BE3F0101000000000000005C1CC9ED85BE3F0101000000000000005F1CC9ED85BE3F010100000000000000601CC9ED85BE3F010100000000000000651CC9ED85BE3F010100000000000000681CC9ED85BE3F013E000000000000006A1CC9ED85BE3F0104000000000000006C1CC9ED85BE3F010100000000000000751CC9ED85BE3F010100000000000000761CC9ED85BE3F0101000000000000007C1CC9ED85BE3F0101000000000000007E1CC9ED85BE3F010300000000000000801CC9ED85BE3F010200000000000000811CC9ED85BE3F010200000000000000831CC9ED85BE3F010500000000000000851CC9ED85BE3F010100000000000000891CC9ED85BE3F0101000000000000008A1CC9ED85BE3F0105000000000000008C1CC9ED85BE3F0101000000000000008D1CC9ED85BE3F0101000000000000008F1CC9ED85BE3F010100000000000000911CC9ED85BE3F010100000000000000951CC9ED85BE3F010100000000000000981CC9ED85BE3F0101000000000000009A1CC9ED85BE3F010100000000000000", 0x10B0).SendRaw(connection);
			// SMSG_SetGameTime
			new SpRaw("97FBE6560000000000000000EEA254110000000000A0AE5600000000000000000000000000", 0x0D52).SendRaw(connection);
			// SMSG_EnterPlayerCharacterToField
			new SMSG_EnterPlayerCharacterToField(connection.ActivePlayer).Send(connection);
			// SMSG_LoadField
			new SpRaw("", 0x0CFE).SendRaw(connection);
			// SMSG_VariExtendSlot
			new SpRaw("010000", 0x1162).SendRaw(connection);
			// SMSG_SkillList
			new SpRaw("011825000100D905000100890600010008030001008806000100BA050001008A020001008A0600010087060001007E02000100BE04000100C4050001008C02000100CC05000100B1020001000D030001008D02000100CF000001008F02000100CE020001008E02000100CB000001008B020001008602000100810200010080020001009002000100D3020001009302000100EB02000100E002000100D7020001007F02000100DD000001005C00000100DC00000100DE00000100580000", 0x0D15).SendRaw(connection);
			// SMSG_SkillAwakenList
			new SpRaw("0000", 0x113C).SendRaw(connection);
			// SMSG_InventorySlotCount
			new SpRaw("12", 0x0C47).SendRaw(connection);
			// SMSG_AddItemToInventory
			new SMSG_AddItemToInventory(connection.ActivePlayer).Send(connection);
			// SMSG_AddItemToInventory
			new SpRaw("0101" + sessionId + "0000000000000000000000000000", 0x0BF1).SendRaw(connection);
			// SMSG_GetAllEquipSlot
			new SMSG_GetAllEquipSlot(connection.ActivePlayer).Send(connection);
			// SMSG_LifeExperienceInformation * 9
			new SpRaw("00010000000000000000000000", 0x1087).SendRaw(connection);
            new SpRaw("01010000000000000000000000", 0x1087).SendRaw(connection);
            new SpRaw("02010000000000000000000000", 0x1087).SendRaw(connection);
            new SpRaw("03010000000000000000000000", 0x1087).SendRaw(connection);
            new SpRaw("04010000000000000000000000", 0x1087).SendRaw(connection);
            new SpRaw("05010000000000000000000000", 0x1087).SendRaw(connection);
            new SpRaw("06010000000000000000000000", 0x1087).SendRaw(connection);
            new SpRaw("07010000000000000000000000", 0x1087).SendRaw(connection);
            new SpRaw("08010000000000000000000000", 0x1087).SendRaw(connection);
			// SMSG_PaymentPassword
			new SpRaw("01DE5A8956000000000E169110DA01000000FA91E2EF01000000BFF1B3AF000000005EFCB343020000009A8ECBC1010000005721E3C301000000B9B43E6E000000007795A06D00000000E580AAC100000000696C543F00000000A97850BF0100000026309223000000001DE008A200000000BF0248CE00000000A132F53000000000614D6B6601000000B89CABD1000000002CF9D01D01000000ECE8F4CE00000000898179FF00000000", 0x0CDF).SendRaw(connection);
			// SMSG_ListFitnessExperience
			new SpRaw("00000000010000000000000000000000010000000100000000000000000000000200000001000000000000000000000000000000000000000000000000000000", 0x1089).SendRaw(connection);
        */
		}

        public void EnterOnWorldProcess(ClientConnection connection, int gameSession)
        {
			/*
            var sessionId = BitConverter.GetBytes(connection.ActivePlayer.GameSessionId).ToHex();
            var uid = BitConverter.GetBytes(connection.ActivePlayer.Uid).ToHex();

			// SMSG_SetCharacterLevels
			new SMSG_SetCharacterLevels(connection.ActivePlayer).Send(connection);
			// SMSG_SetCharacterPrivatePoints
			new SpRaw(sessionId + "60E316000000000000007A440000000000000000000000000000400D0300400D0300400D0300400D0300", 0x0F78).SendRaw(connection);
			// SMSG_SetCharacterStats
			new SpRaw("01" + sessionId + "00004040000080400000803F0000803F00004040000000000000000060E3160000000000010000000000C040000000000000000040420F00000000000000000000000000", 0x0F7B).SendRaw(connection);
			// SMSG_SetCharacterSpeeds
			new SpRaw("000000000000000000000000", 0x0F7D).SendRaw(connection);
			// SMSG_SetCharacterSkillPoints
			new SpRaw("00000000000000000000", 0x0F80).SendRaw(connection);
			// SMSG_SetCharacterProductSkillPoints
			new SpRaw("0000000000000000", 0x0F84).SendRaw(connection);
			// SMSG_UpdateStamina
			new SpRaw("02E8030000C8000000E8030000", 0x0EBC).SendRaw(connection);
			// SMSG_SetCharacterStatPoint
			new SpRaw(sessionId + "0500000005000000050000000A0000000A0000000A0000000000000005000000000000000500000000000000050000000000000005000000", 0x0F7A).SendRaw(connection);
			// SMSG_QuickSlotList
			new SpRaw(uid + "00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000", 0x0D2A).SendRaw(connection);
			// SMSG_ListQuestSelectType
			new SpRaw("00000000000000000000000000000000000000000000000000", 0x0E86).SendRaw(connection);
			// SMSG_ListQuestSortType
			new SpRaw("00000000000000000000", 0x0E89).SendRaw(connection);
			// SMSG_SetMurdererState
			new SpRaw(sessionId + "0000000000000000", 0x0D42).SendRaw(connection);
			//new SpRaw("01000000070006003300000000000000", 0x0e94).SendRaw(connection);
			// SMSG_ListCheckedQuest
			new SpRaw("00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000", 0x0E5C).SendRaw(connection);
			// SMSG_UpdateTitleKey
			new SpRaw("00000000" + sessionId, 0x0CE2).SendRaw(connection);
			//new SpRaw("07007F020000B2020000C8020000D2020000050000001C000000F0020000", 0x10c1).SendRaw(connection);
			// SMSG_ListIntimacy
			new SpRaw("1900AA7501000000679C010000004F9C0100000029A001000000699C01000000519C010000005DC3010000005D9C01000000649C01000000669C01000000689C010000006C9C01000000839C01000000C19C010000009B9E01000000129F01000000149F0100000031A00100000037A0010000003BA0010000004CA0010000004DA0010000004EA00100000078A00100000057C301000000", 0x0EC0).SendRaw(connection);
			// SMSG_ExplorationInfo
			new SpRaw("00001B00290000000000000000000000000001000000010000000000000000004200000000000000000000000000020000000000000000000000000004000000000000000000000000000600000000000000000000000000170000000000000000000000000018000000000000000000000000002B000000000000000000000000003D00000001000000000000000000660000000100000000000000000067000000010000000000000000008B000000000000000000000000008E0000000000000000000000000090000000000000000000000000009B00000000000000000000000000A400000000000000000000000000C9000000000000000000000000002D010000010000000000000000002F0100000000000000000000000035010000000000000000000000004301000000000000000000000000910100000100000000000000000092010000010000000000000000009A01000000000000000000000000B701000000000000000000000000B801000000000000000000000000", 0x0E9B).SendRaw(connection);
			// SMSG_UpdateExplorationPoint
			new SpRaw("0000", 0x0E9E).SendRaw(connection);
			// SMSG_PlantInfo
			new SpRaw("0000", 0x0EC5).SendRaw(connection);
			new SpRaw("0400660000000200000000170000000000DE5A895600000000670000000200000000170000000000DE5A895600000000910100000200000000170000000000DE5A895600000000920100000200000000170000000000DE5A895600000000", 0x0EC5).SendRaw(connection);
			new SpRaw("0000", 0x0EC5).SendRaw(connection);
			// SMSG_ReservedLearningSkill
			new SpRaw("000000000300000000000000", 0x0D2F).SendRaw(connection);
			// SMSG_ListHouseForTownManagement
            new SpRaw("01003F0802000000010000006675615600000000", 0x0E8C).SendRaw(connection);
			// SMSG_ListHouseLargeCraft
			new SpRaw("0000", 0x0E8D).SendRaw(connection);
			//new SpRaw("4A00A80F00000100000028000000020000001000000001000000D20B000001000000D20F0000020000001200000001000000A70F00000100000027000000020000001F000000010000002600000003000000B90B000001000000B90F0000010000003900000001000000B10F0000010000003100000003000000A917000003000000A90F0000020000002900000002000000C40F000001000000440000000100000088000000010000004800000001000000A50F000001000000A51700000100000065000000030000006D000000010000007300000001000000B70F000002000000B700000001000000770000000100000089000000010000008A000000010000009C110000010000009C00000001000000B40F000004000000B4000000010000008701000002000000FC0B000001000000BC0B000002000000C00B0000010000008217000001000000C20B000001000000CB17000001000000CB0B000002000000CF0B0000040000001710000001000000D70B000002000000D80B000001000000DD0B000003000000B20F000002000000F20B000001000000F50B000002000000FB0B000001000000A10F000001000000A20F000002000000A30F000001000000A40F000002000000AA0F000002000000AC0F000001000000AE0F000001000000B00F000001000000BA0F000003000000C60F000001000000D40F000001000000D60F00000100000019100000010000007F17000004000000E017000002000000EC1700000100000070190000010000007119000002000000791900000200000090190000020000004E1E000001000000", 0x0c6f).SendRaw(connection);
			// SMSG_SetWp
			new SpRaw("00001E00", 0x0C6F).SendRaw(connection);
			// SMSG_ListMyVendor
			new SpRaw("0000", 0x0FE4).SendRaw(connection);
			// SMSG_ListProgressChallenge
			new SpRaw("01350027000000000000000000000000002F000000000000000000000000002E000000000000000000000000002D000000000000000000000000002C000000000000000000000000002B000000000000000000000000002A00000000000000000000000000290000000000000000000000000028000000000000000000000000002600000000000000000000000000250000000000000000000000000024000000000000000000000000002300000000000000000000000000220000000000000000000000000021000000000000000000000000002000000000000000000000000000370000000000000000000000000036000000000000000000000000003500000000000000000000000000340000000000000000000000000033000000000000000000000000003200000000000000000000000000310000000000000000000000000030000000000000000000000000000F000000000000000000000000000E000000000000000000000000000D000000000000000000000000000C000000000000000000000000000B000000000000000000000000000A0000000000000000000000000009001300000000000000000000000800130000000000000000000000070013000000000000000000000006001300000000000000000000000500130000000000000000000000040013000000000000000000000003001300000000000000000000001F000000000000000000000000009F000000000000000000000000001E000000000000000000000000001D000000000000000000000000001C000000000000000000000000001B000000000000000000000000001A00000000000000000000000000190000000000000000000000000018000000000000000000000000001700000000000000000000000000160000000000000000000000000015000000000000000000000000001400000000000000000000000000110000000000000000000000000010000000000000000000000000000100000000000000000000000000", 0x10C8).SendRaw(connection);
			//new SpRaw("010E00A10000000000000000000100F0E5875600000000A2000000000000000000020000000000000000007A000000000000000000A30000000000000000007B0000000000000000007C000000000000000000A0000000000000000000A4000000000000000000A500000000000000000012000000000000000000A600000000000000000013000000000000000000", 0x10c4).SendRaw(connection);
			//new SpRaw("010E00A10001000000010013000000A200010000000200010000007A0001000000A300010000007B00010000007C0001000000A00001000000A40001000000A50001000000120001000000A60001000000130001000000", 0x10c5).SendRaw(connection);
			// SMSG_ListPalette
			new SpRaw("01000000", 0x0C2B).SendRaw(connection);
			
			//new SpRaw("00340B0500FCFFFF601589C8CD2E92460046D5C7601589C8CD2E92460046D5C70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000000799E615DCDCCCC3D2E2EC0C7000000000000000000000000000000000000000000007FD6FEBE0000000077095EBF7FD6FEBE0000000077095EBF", 0x0bcd).SendRaw(connection);
			//new SpRaw("00BC4F1200000000000000000000000000000000000000000000000000000000000000000000000000000000000001004D0B00000000E0E1A65F1800000029E2", 0x0d32).SendRaw(connection);
			//new SpRaw("001C590C00FCFFFFC7F6A4C80078FFC5A6DB6B48D42DA6C80078FFC56E3D69480000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000E104000000000A30C925CDCCCC3D2E2EC0C700000000000000000000000000030000000000000000BB8ADD3D000000006D7F7E3FBE7FDD3D00000000957F7E3F", 0x0bcd).SendRaw(connection);
			//new SpRaw("00C44F1200000000000000000000000000000000000000000000000000000000000000000000000000000000000001004D0B00000000E0E1A65F18000000FEFF", 0x0d32).SendRaw(connection);
			//new SpRaw("007C580C00FCFFFF3CFD27C80078FFC5B001AD48042B28C80078FFC51F38AD4800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001007000000000A30C925CDCCCC3D2E2EC0C7000000000000000000000000000300000000000000002279C63E00000000B7FB6BBF68597ABF000000009BF655BE", 0x0bcd).SendRaw(connection);
			//new SpRaw("00745A1200000000000000000000000000000000000000000000000000000000000000000000000000000000000001006C0B00000000E0E1A65F18000000FEFF", 0x0d32).SendRaw(connection);
			//new SpRaw("00FC541200000000000000000000000000000000000000000000000000000000000000000000000000000000000001005C0B00000000E0E1A65F18000000FEFF", 0x0d32).SendRaw(connection);
			//new SpRaw("00844F1200000000000000000000000000000000000000000000000000000000000000000000000000000000000001004C0B00000000E0E1A65F18000000FEFF", 0x0d32).SendRaw(connection);
			//new SpRaw("00EC5F1200000000000000000000000000000000000000000000000000000000000000000000000000000000000001007B0B00000000E0E1A65F18000000FEFF", 0x0d32).SendRaw(connection);
					
			// SMSG_AddPlayers
			new SpRaw("010000000100" + sessionId + "C0100EC80080094580A6D847046788BE0000000080BF763F190000000000164300001643C2DEFFFFFFFFFFFFC2DEFFFFFFFFFFFF0A946DE49500000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000088590D0000000000000000000000000000000000000000000000000000000000FFA6190000000000000000000000000000000000000000000000000000000000FFA6190000000000000000000000000000000000000000000000000000000000FFA6190000000000000000000000000000000000000000000000000000000000000000FE00000000000000006F0917000000000001000000" +
                      uid +
                      "010000000100000000000000010100000000000000000000000000000000000005FCFFFF250000000000000000000000000500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000FCFFFF00010000000000000003000000000000000000000000000000000000000000000037CA00000000000000000000000000000000000000F8FFFF00000000000000000000000000F8FFFF0000000000000000000000000200000000000000000000000000", 0x0BB9).SendRaw(connection);
			// SMSG_AddPlayers
			new SpRaw("010000010100" + sessionId + "C0100EC80080094580A6D847046788BE0000000080BF763F190000000000164300001643C2DEFFFFFFFFFFFFC2DEFFFFFFFFFFFF38946DE495000000000000000000000000000000000300000000000000000000000010302F0000000000000000000000000000000000000000000000000000000000000000000C4B3500000000000000000000000000000000000000000000000000000000000A442D00000000000000000000000000000000000000000000000000000000000C352200000000000000000000000000000000000000000000000000000000000D2A190000000000000000000000000000000000000000000000000000000000074129000000000000000000000000000000000000000000000000000000000008432C0000000000000000000000000000000000000000000000000000000000144E3900000000000000000000000000000000000000000000000000000000000D462D00000000000000000000000000000000000000000000000000000000000D372200000000000000000000000000000000000000000000000000000000000B412A00000000000000000000000000000000000000000000000000000000000C29180000000000000000000000000000000000000000000000000000000000072B190000000000000000000000000000000000000000000000000000000000105E44000000000000000000000000000000000000000000000000000000000009301C0000000000000000000000000000000000000000000000000000000000051F530000000000000000000000000000000000000000000000000000000000043F2800000000000000000000000000000000000000000000000000000000000A3E2700000000000000000000000000000000000000000000000000000000000E382500000000000000000000000000000000000000000000000000000000000C2C1A00000000000000000000000000000000000000000000000000000000000C4C340000000000000000000000000000000000000000000000000000000000063C2500000000000000000000000000000000000000000000000000000000000959400000000000000000000000000000000000000000000000000000000000083F6D0000000000000000000000000000000000000000000000000000000000083E27000000000000000000000000000000000000000000000000000000000009331EFF00000000000000006F0917000000000001000000" +
                      uid +
                      "010000000100000000000000010100000000000000000000000000000000000005FCFFFF250000000000000000000000000500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000FCFFFF00010000000000000003000000000000000000000000000000000000000000000037CA000000000000000000000000000000000000FFFEFFFF000000000000000000000000FFFFFFFF0000000000000000000000000200000000000000000000000000", 0x0BB9).SendRaw(connection);
			// SMSG_ChargeUser
			new SpRaw("00000000000000000000000000000000000000000000000000000000000000000000000000000000", 0x0C0A).SendRaw(connection);
			// SMSG_PlayerLogOnOff
			new SpRaw(sessionId + "6F09170000000000" +
                      uid +
                      "DE5A89560000000000000000000000002100070054006F006F0048006F007400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000C2DEFFFFFFFFFFFF49006E004300750062006500460054005700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000028001900", 0x0D45).SendRaw(connection);

            new SMSG_RefreshPcCustomizationCache(connection.ActivePlayer).Send(connection);

            Core.Act(s =>
            {
                s.CharacterProcessor.EndLoad(connection);
                s.WorldProcessor.EndLoad(connection);
            });
			*/
        }

		public void BackToServerSelection(ClientConnection connection, int cookieId)
		{
			
			// TODO: method / task
			new SMSG_ExitFieldServerToServerSelection().Send(connection);
		}

		public object OnUnload()
        {
            return null;
        }

        #region static
        public static int GetCharactersCount(int accountId)
        {
            lock (_gsObj)
            using (var db = _gsDbFactory.OpenSession())
                {
                    int count = db.QueryOver<CharacterData>().Where(p => p.AccountId == accountId).List().Count;

                    return count;
                }
        }

        #endregion

    }
}
